<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é³é›¨é»˜çš„æ–°å¹´æŠ½å¥–</title>
    <style>
        :root {
            --primary-red: #d90616;
            --dark-red: #8f000b;
            --gold: #f5d17e;
            --light-gold: #fff4d6;
            --border-radius: 8px;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(180deg, var(--primary-red) 0%, var(--dark-red) 100%);
            color: #333;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* é¡¶éƒ¨ç´§å‡‘åŒ– */
        header {
            text-align: center;
            padding: 10px 0 5px 0;
            color: var(--gold);
            flex-shrink: 0;
        }

        h1 {
            margin: 0;
            font-size: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            font-size: 0.8rem;
            opacity: 0.9;
            margin-top: 2px;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ - å¯æ»šåŠ¨ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-y: auto;
            padding-bottom: 20px;
            width: 100%;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            width: 92%;
            max-width: 350px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 244, 214, 0.3);
            margin-top: 5px;
            flex-shrink: 0;
        }

        /* æŠ½å¥–ç½‘æ ¼ */
        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            margin-bottom: 10px;
        }

        .cell {
            background: #fff;
            aspect-ratio: 1;
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2px;
            text-align: center;
            font-size: 9px;
            position: relative;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
        }

        .cell img {
            width: 55%;
            height: 55%;
            object-fit: contain;
            margin-bottom: 2px;
        }

        .cell.active {
            background: var(--gold);
            transform: scale(1.05);
            box-shadow: 0 0 10px var(--gold), inset 0 0 2px #fff;
            border: 2px solid #fff;
            z-index: 2;
        }

        /* æ§åˆ¶åŒº */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            width: 100%;
        }

        .info-panel {
            display: flex;
            justify-content: space-between;
            width: 100%;
            color: var(--gold);
            font-size: 0.9rem;
            font-weight: bold;
            padding: 0 5px;
        }

        button {
            border: none;
            outline: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .btn-main {
            background: linear-gradient(to bottom, #fce38a, #f38181);
            color: var(--dark-red);
            padding: 10px 0;
            font-size: 1.3rem;
            border-radius: 50px;
            box-shadow: 0 4px 0 #c0392b, 0 5px 10px rgba(0, 0, 0, 0.3);
            width: 95%;
        }

        .btn-main:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 #c0392b;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            width: 100%;
            justify-content: center;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 8px 12px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            font-size: 0.8rem;
            flex: 1;
        }

        /* --- å¤§å¥–è§£é”å¡ç‰‡ --- */
        .unlock-card {
            display: none;
            width: 92%;
            max-width: 350px;
            background: #ff753a;
            border-radius: 12px;
            padding: 12px;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .prize-target-info {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #eee;
        }

        .target-img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-right: 12px;
            background: #f9f9f9;
        }

        .target-desc { flex: 1; }
        .target-title { font-size: 0.8rem; color: #888; margin-bottom: 2px; }
        .target-name { font-size: 1.1rem; color: #333; font-weight: bold; }

        .progress-container {
            width: 100%;
            height: 16px;
            background: #eee;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 8px;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00c6ff, #0072ff);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
            color: #333;
            font-weight: bold;
            z-index: 2;
        }

        .btn-unlock {
            width: 100%;
            padding: 10px;
            background: #ccc;
            color: #fff;
            border-radius: 8px;
            font-size: 1rem;
            margin-top: 5px;
        }

        .btn-unlock.active {
            background: linear-gradient(90deg, #11998e, #38ef7d);
            animation: pulse 1.5s infinite;
        }

        /* åº•éƒ¨å•ç‹¬çš„å‹æƒ…é“¾æ¥ */
        .footer-simple {
            width: 100%;
            text-align: center;
            padding: 15px 0;
            flex-shrink: 0;
        }

        .friend-link { font-size: 0.75rem; color: rgba(255, 255, 255, 0.6); }
        .friend-link a { color: rgba(255, 255, 255, 0.8); text-decoration: none; border-bottom: 1px dashed rgba(255, 255, 255, 0.4); }

        /* å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); z-index: 1000;
            display: none; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.2s;
        }
        .modal-overlay.show { opacity: 1; }

        .modal {
            background: #fff; width: 85%; max-width: 320px; border-radius: 15px; padding: 20px;
            transform: scale(0.9); transition: transform 0.2s; max-height: 80vh; overflow-y: auto;
            position: relative;
        }
        .modal-overlay.show .modal { transform: scale(1); }

        .modal-title {
            text-align: center; color: var(--primary-red); font-size: 1.2rem;
            margin-bottom: 15px; font-weight: bold;
        }

        .close-btn { position: absolute; top: 8px; right: 12px; font-size: 20px; color: #999; cursor: pointer; }

        .task-item {
            background: #f9f9f9; padding: 10px; border-radius: 8px; margin-bottom: 8px;
            border: 1px solid #eee; font-size: 0.9rem;
        }
        .task-input { width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; margin: 5px 0; }
        .task-btn { background: var(--primary-red); color: #fff; padding: 5px 10px; border-radius: 4px; width: 100%; font-size: 0.85rem; }
        .result-img { width: 120px; height: 120px; margin: 0 auto 15px; display: block; object-fit: contain; }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
    </style>
</head>

<body>

    <header>
        <h1>ğŸ‰ é³é›¨é»˜çš„æ–°å¹´æŠ½å¥–</h1>
        <div class="subtitle">Happy New Year 2026</div>
    </header>

    <div class="main-content">
        <div class="container">
            <div class="grid" id="lotteryGrid"></div>

            <div class="controls">
                <div class="info-panel">
                    <span>å‰©ä½™æ¬¡æ•°: <span id="spinCount">0</span></span>
                    <span>ğŸ’ é’»çŸ³: <span id="diamondCount">0</span></span>
                </div>

                <button class="btn-main" id="spinBtn" onclick="startSpin()">ç«‹å³æŠ½å¥–</button>

                <div class="action-buttons">
                    <button class="btn-secondary" onclick="openModal('rewardsModal')">æˆ‘çš„å¥–åŠ± ğŸ</button>
                    <button class="btn-secondary" onclick="openModal('taskModal'); renderTasks();">è·å–æ¬¡æ•° ğŸ“</button>
                </div>
            </div>
        </div>

        <div class="unlock-card" id="unlockCard">
            <div class="prize-target-info">
                <img src="" id="targetPrizeImg" class="target-img">
                <div class="target-desc">
                    <div class="target-title">æ­£åœ¨è§£é”å¤§å¥–</div>
                    <div class="target-name" id="targetPrizeName">???</div>
                </div>
                <div style="font-size:1.2rem;">ğŸ”’</div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
                <div class="progress-text" id="progressText">0/120</div>
            </div>
            <button class="btn-unlock" id="unlockBtn" onclick="unlockGrandPrize()">é’»çŸ³ä¸è¶³ï¼Œå»ç­”é¢˜ï¼</button>
        </div>
    </div>

    <div class="footer-simple">
        <div class="friend-link">
            <a href="http://camera.overblue.cn" target="_blank">camera.overblue.cn</a>
        </div>
    </div>

    <div class="modal-overlay" id="taskModal">
        <div class="modal">
            <span class="close-btn" onclick="closeModal('taskModal')">&times;</span>
            <div class="modal-title" id="taskTitle">å®Œæˆä»»åŠ¡è·å–æ¬¡æ•°</div>
            <div id="taskListContent"></div>
        </div>
    </div>

    <div class="modal-overlay" id="resultModal">
        <div class="modal" style="text-align: center;">
            <div class="modal-title">ğŸ‰ æ­å–œè·å¾— ğŸ‰</div>
            <img src="" alt="å¥–å“" id="resultImage" class="result-img">
            <div class="result-text" id="resultName"></div>
            <button class="btn-main" style="font-size: 1rem; padding: 10px 30px;" onclick="claimReward()">å¼€å¿ƒæ”¶ä¸‹</button>
        </div>
    </div>

    <div class="modal-overlay" id="rewardsModal">
        <div class="modal">
            <span class="close-btn" onclick="closeModal('rewardsModal')">&times;</span>
            <div class="modal-title">æˆ‘çš„å¥–åŠ±è®°å½•</div>
            <div id="myRewardsList" style="max-height: 250px; overflow-y: auto;">
                <p style="text-align:center; color:#999; font-size:0.9rem;">æš‚æ— è®°å½•</p>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="unlockSuccessModal">
        <div class="modal" style="text-align: center;">
            <div class="modal-title">ğŸ”“ è§£é”æˆåŠŸï¼</div>
            <img src="" alt="å¤§å¥–" id="grandPrizeImg" class="result-img">
            <div class="result-text" id="grandPrizeText"></div>
            <p style="font-size:0.9rem; color:#666;">å¿«æˆªå›¾æ‰¾OverBlueå…‘æ¢å§ï¼</p>
            <button class="btn-main" onclick="closeModal('unlockSuccessModal')">å¤ªæ£’äº†å§</button>
        </div>
    </div>

    <audio id="bgm" src="./music/bgm.mp3" loop></audio>

    <script>
        // --- æ•°æ®å®šä¹‰ ---
        const prizes = [
            { id: 0, name: "è°¢è°¢å‚ä¸\nå†æ¥å†å‰", type: 0, img: "./image/thanks.png" },
            { id: 1, name: "é©¬åˆ°æˆåŠŸï¼\nä¸‡äº‹å¦‚æ„ï¼", type: 1, img: "./image/bless1.png" },
            { id: 2, name: "è°¢è°¢å‚ä¸\nä¸‹æ¬¡å¥½è¿", type: 0, img: "./image/thanks.png" },
            { id: 3, name: "é©¬ä¸Šæœ‰é’±\né©¬å¹´å–œä¹ï¼ï¼", type: 1, img: "./image/bless2.png" },
            { id: 4, name: "10ä¸ªé’»çŸ³", type: 2, img: "./image/diamond.png" },
            { id: 5, name: "å¿ƒæƒ³äº‹æˆ\nå¥½è¿è¿è¿ï¼", type: 1, img: "./image/bless3.png" },
            { id: 6, name: "10ä¸ªé’»çŸ³", type: 2, img: "./image/diamond.png" },
            { id: 7, name: "èº«ä½“å¥åº·\nå¹³å®‰å–œä¹ï¼", type: 1, img: "./image/bless4.png" },
            { id: 8, name: "10ä¸ªé’»çŸ³", type: 2, img: "./image/diamond.png" },
            { id: 9, name: "è°¢è°¢å‚ä¸\næ“¦è‚©è€Œè¿‡", type: 0, img: "./image/thanks.png" },
            { id: 10, name: "10ä¸ªé’»çŸ³", type: 2, img: "./image/diamond.png" },
            // ç¥ç§˜å¤§å¥– (type 3)
            { id: 11, name: "361Â°ç²¾è‡´å–·é›¾", type: 3, code: 'lsy', img: "./image/spray.png" },
            { id: 12, name: "å¤èŒ—å¥¶èŒ¶ä¸€æ¯", type: 3, code: 'wjx', img: "./image/guming.png" },
            { id: 13, name: "ç‘å¹¸å’–å•¡ä¸€æ¯", type: 3, code: 'yfk', img: "./image/luckin.png" },
            { id: 14, name: "è¯·é³é›¨é»˜å–å¥¶èŒ¶", type: 3, code: 'hi2026', img: "./image/milktea.png" },
            { id: 15, name: "é³é›¨é»˜çš„ä¸“å±ç¥ç¦", type: 3, code: 'jymyyds', img: "./image/special.png" }
        ];

        // æš´å‡»ä»£ç æ˜ å°„è¡¨ (ç§»åˆ°å…¨å±€ä»¥ä¾¿éªŒè¯)
        const cheatMap = { 'lsy': 11, 'wjx': 12, 'yfk': 13, 'hi2026': 14, 'jymyyds': 15 };

        const riddles = [
            { q: "ä»€ä¹ˆä¸œè¥¿è¶Šæ´—è¶Šè„ï¼Ÿ", o: ["è¡£æœ", "æ°´", "æŠ¹å¸ƒ", "è‚¥çš‚"], a: "B" },
            { q: "ä»€ä¹ˆé—¨å…³ä¸ä¸Šï¼Ÿ", o: ["é˜²ç›—é—¨", "çƒé—¨", "åé—¨", "å†°ç®±é—¨"], a: "B" },
            { q: "ä»€ä¹ˆä¹¦ä¹°ä¸åˆ°ï¼Ÿ", o: ["æ•™ç§‘ä¹¦", "ç§˜ä¹¦", "æ¼«ç”»ä¹¦", "ç™¾ç§‘å…¨ä¹¦"], a: "B" },
            { q: "ä»€ä¹ˆè·¯ä¸èƒ½èµ°ï¼Ÿ", o: ["å±±è·¯", "ç”µè·¯", "å…¬è·¯", "å°è·¯"], a: "B" },
            { q: "ä»€ä¹ˆç‰›ä¸ä¼šåƒè‰ï¼Ÿ", o: ["æ°´ç‰›", "èœ—ç‰›", "å¥¶ç‰›", "é»„ç‰›"], a: "B" },
            { q: "ä»€ä¹ˆç“œä¸èƒ½åƒï¼Ÿ", o: ["è¥¿ç“œ", "å†¬ç“œ", "å‚»ç“œ", "å—ç“œ"], a: "C" },
            { q: "ä»€ä¹ˆé’ˆä¸èƒ½ç¼è¡£æœï¼Ÿ", o: ["ç»£èŠ±é’ˆ", "å¤§å¤´é’ˆ", "æŒ‡å—é’ˆ", "ç¼è¡£é’ˆ"], a: "C" },
            { q: "ä»€ä¹ˆå¸½ä¸èƒ½æˆ´ï¼Ÿ", o: ["è‰å¸½", "ç¤¼è²Œ", "å†›å¸½", "å¤ªé˜³å¸½"], a: "B" },
            { q: "ä»€ä¹ˆåºŠä¸èƒ½ç¡ï¼Ÿ", o: ["æœ¨åºŠ", "ç‰™åºŠ", "é“åºŠ", "åŒäººåºŠ"], a: "B" },
            { q: "ä»€ä¹ˆé±¼ä¸èƒ½åƒï¼Ÿ", o: ["é‡‘é±¼", "æœ¨é±¼", "é²¤é±¼", "è‰é±¼"], a: "B" },
            { q: "ä»€ä¹ˆé…’ä¸èƒ½å–ï¼Ÿ", o: ["ç™½é…’", "å•¤é…’", "ç¢˜é…’", "çº¢é…’"], a: "C" },
            { q: "ä»€ä¹ˆè›‹ä¸èƒ½åƒï¼Ÿ", o: ["é¸¡è›‹", "é¸­è›‹", "ç¬¨è›‹", "é¹…è›‹"], a: "C" },
            { q: "ä»€ä¹ˆèŠ±ä¸ä¼šå¼€ï¼Ÿ", o: ["ç«ç‘°èŠ±", "çƒŸèŠ±", "èŠèŠ±", "æ¢…èŠ±"], a: "B" },
            { q: "ä»€ä¹ˆè½¦ä¸ä¼šè·‘ï¼Ÿ", o: ["æ±½è½¦", "é£è½¦", "ç«è½¦", "è‡ªè¡Œè½¦"], a: "B" },
            { q: "ä»€ä¹ˆé¸Ÿä¸ä¼šé£ï¼Ÿ", o: ["éº»é›€", "é¸µé¸Ÿ", "ç‡•å­", "é¸½å­"], a: "B" },
            { q: "ä»€ä¹ˆçƒä¸èƒ½è¸¢ï¼Ÿ", o: ["è¶³çƒ", "ç¯®çƒ", "çœ¼çƒ", "æ’çƒ"], a: "C" },
            { q: "ä»€ä¹ˆèœä¸èƒ½åƒï¼Ÿ", o: ["ç™½èœ", "é’èœ", "æ™•èœ", "èåœ"], a: "C" }
        ];

        let spins = 0;
        let diamonds = 0;
        let isSpinning = false;
        let grandPrizeLocked = false;
        let currentTargetPrize = null;
        let currentCheatCode = "";
        let userRewards = [];
        let pendingReward = null;
        let doneTasks = { 1: false, 2: false, 3: false, 4: false };
        let usedRiddleIndices = [];

        // Elements
        const gridEl = document.getElementById('lotteryGrid');
        const spinCountEl = document.getElementById('spinCount');
        const diamondCountEl = document.getElementById('diamondCount');
        const unlockCard = document.getElementById('unlockCard');
        const bgm = document.getElementById('bgm');

        function init() {
            prizes.forEach((p, index) => {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${index}`;
                cell.innerHTML = `<img src="${p.img}" alt="gift"><span>${p.name.split('\n')[0]}</span>`;
                gridEl.appendChild(cell);
            });
            document.body.addEventListener('click', () => { if (bgm.paused) bgm.play().catch(() => { }); }, { once: true });
        }
        init();

        function startSpin() {
            if (isSpinning) return;

            // --- ä¿®æ”¹ï¼šå¼ºåˆ¶æ£€æŸ¥å‰ç½®ä»»åŠ¡ ---
            if (!doneTasks[3] || !doneTasks[4]) {
                alert("ğŸ”’ è¯·å…ˆå®Œæˆã€ç¥ç§˜ä»£ç ã€‘å’Œã€æš´å‡»ä»£ç ã€‘ä»»åŠ¡\næ‰èƒ½æ¿€æ´»æŠ½å¥–ç³»ç»Ÿï¼");
                openModal('taskModal');
                renderTasks();
                return;
            }

            if (spins <= 0) {
                alert("æŠ½å¥–æ¬¡æ•°ä¸è¶³ï¼Œè¯·å…ˆåšä»»åŠ¡ï¼");
                openModal('taskModal'); renderTasks();
                return;
            }

            isSpinning = true;
            spins--; // æ‰£é™¤æ¬¡æ•°
            updateUI();

            let targetIndex = Math.floor(Math.random() * 11);

            // æš´å‡»é€»è¾‘ï¼šæœ€åä¸€æ¬¡æŠ½å¥–ç”Ÿæ•ˆ (spins å·²ç»å‡ä¸º 0)
            if (spins === 0 && !grandPrizeLocked) {
                if (cheatMap[currentCheatCode]) targetIndex = cheatMap[currentCheatCode];
            }

            // æé€ŸæŠ½å¥–é€»è¾‘ (2.5s)
            let currentIndex = 0;
            let speed = 30;
            let steps = 0;
            const minSteps = 16 * 2 + targetIndex;

            function step() {
                document.querySelectorAll('.cell').forEach(c => c.classList.remove('active'));
                const actualIndex = currentIndex % 16;
                document.getElementById(`cell-${actualIndex}`).classList.add('active');

                if (steps >= minSteps) {
                    isSpinning = false;
                    handleWin(targetIndex);
                } else {
                    steps++;
                    currentIndex++;
                    const stepsRemaining = minSteps - steps;
                    if (stepsRemaining < 8) speed += 50 + (8 - stepsRemaining) * 10;
                    setTimeout(step, speed);
                }
            }
            step();
        }

        function handleWin(index) {
            const prize = prizes[index];
            pendingReward = prize;
            document.getElementById('resultImage').src = prize.img;
            document.getElementById('resultName').innerText = prize.name;
            setTimeout(() => openModal('resultModal'), 200);
        }

        function claimReward() {
            closeModal('resultModal');
            if (!pendingReward) return;

            // è®°å½•å¥–åŠ±
            if (pendingReward.type !== 0) userRewards.push(pendingReward);

            if (pendingReward.type === 2) {
                diamonds += 10;
            } else if (pendingReward.type === 3) {
                alert("âš ï¸ å“‡ï¼æŠ½ä¸­ã€ç¥ç§˜å¤§å¥–ã€‘ï¼\n\nä½†è¿˜éœ€è¦æ”¶é›†120ä¸ªé’»çŸ³æ‰èƒ½çœŸæ­£è§£é”å¸¦èµ°ï¼");
                triggerGrandPrizeMode(pendingReward);
            }

            updateUI();
            pendingReward = null;
        }

        function triggerGrandPrizeMode(prize) {
            if (grandPrizeLocked) return;
            grandPrizeLocked = true;
            currentTargetPrize = prize;

            // å¡«å……å¡ç‰‡ä¿¡æ¯
            document.getElementById('targetPrizeImg').src = prize.img;
            document.getElementById('targetPrizeName').innerText = prize.name;

            unlockCard.style.display = 'block';
            document.getElementById('taskTitle').innerText = "ç­”é¢˜èµ¢é’»çŸ³";

            // æ»šåŠ¨åˆ°åº•éƒ¨è®©ç”¨æˆ·çœ‹åˆ°æ–°å¡ç‰‡
            setTimeout(() => {
                document.querySelector('.main-content').scrollTop = document.querySelector('.main-content').scrollHeight;
            }, 300);
        }

        function unlockGrandPrize() {
            // ä¿®æ”¹ï¼šåˆ¤æ–­æ”¹ä¸º120ä¸ªé’»çŸ³
            const unlockCost = 120;
            if (diamonds >= unlockCost) {
                if (currentTargetPrize) {
                    document.getElementById('grandPrizeImg').src = currentTargetPrize.img;
                    document.getElementById('grandPrizeText').innerText = currentTargetPrize.name;
                    openModal('unlockSuccessModal');
                    diamonds -= unlockCost;
                    updateUI();
                }
            } else {
                alert(`é’»çŸ³ä¸è¶³ï¼éœ€è¦${unlockCost}ä¸ªï¼Œå¿«å»[è·å–æ¬¡æ•°]ç­”é¢˜èµšé’»çŸ³å§ï¼`);
            }
        }

        function updateUI() {
            spinCountEl.innerText = spins;
            diamondCountEl.innerText = diamonds;

            // å¥–åŠ±åˆ—è¡¨æ›´æ–°
            const list = document.getElementById('myRewardsList');
            if (userRewards.length === 0) list.innerHTML = "<p style='text-align:center;color:#999;font-size:0.9rem'>æš‚æ— </p>";
            else list.innerHTML = userRewards.map(r => `<div style="display:flex;align-items:center;padding:5px;border-bottom:1px solid #eee"><img src="${r.img}" style="width:30px;height:30px;margin-right:10px"><div>${r.name.replace('\n', ' ')}</div></div>`).join('');

            // è§£é”å¡ç‰‡çŠ¶æ€æ›´æ–°
            if (grandPrizeLocked) {
                const bar = document.getElementById('progressBar');
                const txt = document.getElementById('progressText');
                const btn = document.getElementById('unlockBtn');
                
                // ä¿®æ”¹ï¼šè¿›åº¦æ¡åˆ†æ¯æ”¹ä¸º120
                const target = 120;
                let pct = Math.min((diamonds / target) * 100, 100);
                bar.style.width = pct + "%";
                txt.innerText = `${diamonds}/${target}`;

                if (diamonds >= target) {
                    btn.classList.add('active');
                    btn.innerHTML = "ğŸ”“ é’»çŸ³å·²æ»¡ï¼Œç‚¹å‡»ç«‹å³è§£é”ï¼";
                    btn.style.background = "linear-gradient(90deg, #11998e, #38ef7d)";
                } else {
                    btn.classList.remove('active');
                    btn.innerHTML = `ğŸ”’ éœ€${target}é’»çŸ³è§£é” (è¿˜å·®${target - diamonds})`;
                    btn.style.background = "#ccc";
                }
            }
        }

        // --- ä»»åŠ¡é€»è¾‘ ---
        function renderTasks() {
            const container = document.getElementById('taskListContent');
            container.innerHTML = "";

            if (!grandPrizeLocked) {
                if (!doneTasks[1]) addTask(container, "1. é³é›¨é»˜ç”Ÿæ—¥ (YYYY-MM-DD)", "date", "input-dob", checkTask1);
                if (!doneTasks[2]) addRadioTask(container);
                if (!doneTasks[3]) addTask(container, "3. ç¥ç§˜ä»£ç  (å¿…å¡«)", "text", "input-code-10", checkTask3);
                if (!doneTasks[4]) addTask(container, "4. æš´å‡»ä»£ç  (å¿…å¡«,æœ€åä¸€æ¬¡ç”Ÿæ•ˆ)", "text", "input-cheat", checkTask4);
            } else {
                // è°œè¯­æ¨¡å¼
                let availableIndices = riddles.map((_, i) => i).filter(i => !usedRiddleIndices.includes(i));
                if (availableIndices.length === 0) { container.innerHTML = "<p>é¢˜åº“å·²ç©º</p>"; return; }

                const rIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
                const riddle = riddles[rIndex];

                const div = document.createElement('div');
                div.className = 'task-item';
                div.innerHTML = `
                <div style="font-weight:bold;margin-bottom:5px;">${riddle.q}</div>
                ${riddle.o.map((opt, i) => `<label style="display:block;margin:3px 0;"><input type="radio" name="riddle-opt" value="${String.fromCharCode(65 + i)}"> ${String.fromCharCode(65 + i)}. ${opt}</label>`).join('')}
                <button class="task-btn" onclick="checkRiddle(${rIndex}, '${riddle.a}')">æäº¤ (+1æ¬¡)</button>
            `;
                container.appendChild(div);
            }
        }

        function addTask(parent, label, type, id, fn) {
            const div = document.createElement('div');
            // å¦‚æœæ˜¯å¿…å¡«ä¸”æœªå®Œæˆçš„ä»»åŠ¡ï¼ŒåŠ ç‚¹æ ·å¼æç¤º
            const isPendingRequired = (id === 'input-code-10' && !doneTasks[3]) || (id === 'input-cheat' && !doneTasks[4]);
            if(isPendingRequired) div.style.border = "1px solid #ff753a";
            
            div.className = 'task-item';
            div.innerHTML = `<label style="font-weight:bold">${label}</label><input type="${type}" id="${id}" class="task-input"><button class="task-btn" id="btn-${id}">æäº¤</button>`;
            parent.appendChild(div);
            document.getElementById(`btn-${id}`).onclick = fn;
        }
        function addRadioTask(parent) {
            const div = document.createElement('div');
            div.className = 'task-item';
            div.innerHTML = `<label style="font-weight:bold">2. å“ªä¸ªæ˜¯é³é›¨é»˜çš„IDï¼Ÿ</label>
        <label style="display:block"><input type="radio" name="id-opt" value="A"> A. æµ·é¢ä¸Šæœ‰</label>
        <label style="display:block"><input type="radio" name="id-opt" value="B"> B. æµ·é¢ä¸Šæ²¡æœ‰</label>
        <label style="display:block"><input type="radio" name="id-opt" value="C"> C. æ–‡å±±å½­äºæ™</label>
        <label style="display:block"><input type="radio" name="id-opt" value="D"> D. æ–‡å±±ç¬¬ä¸€æ·±æƒ…</label>
        <button class="task-btn" style="margin-top:5px" onclick="checkTask2()">æäº¤ (+1æ¬¡)</button>`;
            parent.appendChild(div);
        }

        function checkTask1() { if (document.getElementById('input-dob').value === '2008-02-26') { alert('æ­£ç¡®ï¼+1æ¬¡'); spins++; doneTasks[1] = true; updateUI(); renderTasks(); } else alert('é”™è¯¯'); }
        function checkTask2() { const sel = document.querySelector('input[name="id-opt"]:checked'); if (sel && sel.value === 'A') { alert('æ­£ç¡®ï¼+1æ¬¡'); spins++; doneTasks[2] = true; updateUI(); renderTasks(); } else alert('é”™è¯¯'); }

        function checkTask3() {
            const inputVal = document.getElementById('input-code-10').value.trim();
            if (!/^[a-zA-Z0-9]+$/.test(inputVal)) { alert("è¯·è¾“å…¥çº¯å­—æ¯æˆ–æ•°å­—ï¼"); return; }
            if (inputVal === 'overblue026') { alert('æ­£ç¡®ï¼+10æ¬¡'); spins += 10; doneTasks[3] = true; updateUI(); renderTasks(); } else alert('ä»£ç é”™è¯¯');
        }

        function checkTask4() {
            const val = document.getElementById('input-cheat').value.trim();
            if (!/^[a-zA-Z0-9]+$/.test(val)) { alert("è¯·è¾“å…¥çº¯å­—æ¯æˆ–æ•°å­—ï¼"); return; }
            
            // ä¿®æ”¹ï¼šéªŒè¯ä»£ç æ˜¯å¦åœ¨æ˜ å°„è¡¨ä¸­
            if (cheatMap.hasOwnProperty(val)) {
                currentCheatCode = val; 
                doneTasks[4] = true; 
                alert('æŸç§ç¥ç§˜æ­£åœ¨é™ä¸´...'); 
                renderTasks(); 
            } else {
                alert('ä»£ç æ— æ•ˆ');
            }
        }

        function checkRiddle(idx, ans) { const sel = document.querySelector('input[name="riddle-opt"]:checked'); if (sel && sel.value === ans) { alert('æ­£ç¡®ï¼+1æ¬¡'); spins++; usedRiddleIndices.push(idx); updateUI(); renderTasks(); } else alert('é”™è¯¯'); }

        // Helpers
        window.openModal = (id) => { const m = document.getElementById(id); m.style.display = 'flex'; setTimeout(() => m.classList.add('show'), 10); };
        window.closeModal = (id) => { const m = document.getElementById(id); m.classList.remove('show'); setTimeout(() => m.style.display = 'none', 200); };
    </script>
</body>

</html>